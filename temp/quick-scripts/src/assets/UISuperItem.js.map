{"version":3,"sources":["assets/UISuperItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UISuperLayout, { UISuperAxis } from './UISuperLayout';\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class UISpuerItem extends cc.Component {\n    private layout: UISuperLayout\n    private refreshItemCallback: Function\n    private isOutOfBoundaryTop: Function\n    private isOutOfBoundaryBottom: Function\n\n    onLoad() {\n        this.node['getBounding'] = this.getBounding.bind(this)\n    }\n    public init(layout: UISuperLayout, refreshItemCallback: Function, isOutOfBoundaryTop: Function, isOutOfBoundaryBottom: Function) {\n        this.layout = layout\n        this.refreshItemCallback = refreshItemCallback\n        this.isOutOfBoundaryTop = isOutOfBoundaryTop\n        this.isOutOfBoundaryBottom = isOutOfBoundaryBottom\n    }\n    private getBounding() {\n        this.node.parent['_updateWorldMatrix']()\n        let width = this.node.getContentSize().width\n        let height = this.node.getContentSize().height\n        let rect = cc.rect(-this.node.getAnchorPoint().x * width, -this.node.getAnchorPoint().y * height, width, height)\n        this.node['_calculWorldMatrix']();\n        rect.transformMat4(rect, this.node['_worldMatrix']);\n        return rect\n    }\n    private get isHeader() {\n        return this.node.getSiblingIndex() == 0\n    }\n    private get isFooter() {\n        return this.node.getSiblingIndex() == this.layout.node.childrenCount - 1\n    }\n    private get isUpdateHeader() {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && this.layout.scrollView.deltaMove.y > 0 && this.isHeader) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && this.layout.scrollView.deltaMove.x < 0 && this.isHeader) {\n            return true\n        }\n        return false\n    }\n    private get isUpdateFooter() {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && this.layout.scrollView.deltaMove.y < 0 && this.isFooter) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && this.layout.scrollView.deltaMove.x > 0 && this.isFooter) {\n            return true\n        }\n        return false\n    }\n\n    private isOutOfBoundary(offset: cc.Vec2) {\n        if (this.layout.startAxis == UISuperAxis.VERTICAL && offset.y == 0) {\n            return true\n        }\n        if (this.layout.startAxis == UISuperAxis.HORIZONTAL && offset.x == 0) {\n            return true\n        }\n        return false\n    }\n\n    private relativePositionBottom(prevNode: cc.Node) {\n        if (prevNode) {\n            if (this.layout.startAxis == UISuperAxis.VERTICAL) {\n                let prevHeight = prevNode.height * this.layout.getUsedScaleValue(prevNode.scaleY)\n                let offset = (prevNode.y - (prevHeight * prevNode.anchorY)) - (this.node.height * (1 - this.node.anchorY)) - this.layout.spacing.y\n                this.node.y = offset\n            } else if (this.layout.startAxis == UISuperAxis.HORIZONTAL) {\n                let prevWidth = prevNode.width * this.layout.getUsedScaleValue(prevNode.scaleX)\n                let offset = prevNode.x + (prevWidth * (1 - prevNode.anchorX)) + (this.node.width * this.node.anchorX) + this.layout.spacing.x\n                this.node.x = offset\n            }\n        }\n    }\n    private relativePositionTop(prevNode: cc.Node) {\n        if (prevNode) {\n            if (this.layout.startAxis == UISuperAxis.VERTICAL) {\n                let prevHeight = prevNode.height * this.layout.getUsedScaleValue(prevNode.scaleY)\n                let offset = prevNode.y + (prevHeight * (1 - prevNode.anchorY)) + (this.node.height * this.node.anchorY) + this.layout.spacing.y\n                this.node.y = offset\n            } else if (this.layout.startAxis == UISuperAxis.HORIZONTAL) {\n                let prevWidth = prevNode.width * this.layout.getUsedScaleValue(prevNode.scaleX)\n                let offset = prevNode.x - (prevWidth * prevNode.anchorX) - (this.node.width * (1 - this.node.anchorX)) - this.layout.spacing.x\n                this.node.x = offset\n            }\n        }\n    }\n    private watchBrother() {\n        let prevIndex = this.node.getSiblingIndex() - 1\n        let prevNode = this.node.parent.children[prevIndex]\n        this.relativePositionBottom(prevNode)\n    }\n    private watchSelf() {\n        // 向下填充\n        if (this.isUpdateHeader) {\n            if (this.layout.footer['index'] + 1 == this.layout.maxItemTotal) return\n            let offset = this.isOutOfBoundaryTop(this.node)\n            if (this.isOutOfBoundary(offset)) {\n                this.node['index'] = this.layout.footer['index'] + 1\n                this.relativePositionBottom(this.layout.footer)\n                this.node.setSiblingIndex(this.layout.node.childrenCount - 1)\n                this.refreshItemCallback(this.node, this.node['index'])\n            }\n        }\n        // 向上填充\n        if (this.isUpdateFooter) {\n            if (this.layout.header['index'] == 0) return\n            let offset = this.isOutOfBoundaryBottom(this.node)\n            if (this.isOutOfBoundary(offset)) {\n                this.node['index'] = this.layout.header['index'] - 1\n                this.relativePositionTop(this.layout.header)\n                this.node.setSiblingIndex(0)\n                this.refreshItemCallback(this.node, this.node['index'])\n            }\n        }\n    }\n    update(dt) {\n        this.watchBrother()\n        this.watchSelf()\n    }\n}\n"]}